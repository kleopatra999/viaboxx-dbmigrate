#summary How to use the viaboxx dbmigrate plugin
#labels Featured

=viaboxx dbmigrate plugin = 
Integration of agimatec-tools/dbmigrate into a grails project.

=use the plugin in your grails project=

{{{
grails install-plugin ../viaboxx-dbmigrate/grails-viaboxx-dbmigrate-0.1.zip
}}}

where "../viaboxx-dbmigrate/grails-viaboxx-dbmigrate-0.1.zip" is the path to the plugin package

=prepare your grails project=

  * create a folder "database" (at any location you like)
  * create a configuration under grails-app/conf/DbMigrate.groovy
  * create setup.xml or upgrade.xml under database and
 configure "setup" or "upgrade" as mainConfig in DbMigrate.groovy

add a dependency in your pom.xml (or BootConfig.groovy) of your grails project to dbmigrate
{{{
 <dependency>
      <groupId>com.agimatec</groupId>
      <artifactId>dbmigrate</artifactId>
      <version>2.3.1-SNAPSHOT</version>
      <exclusions>
        <exclusion>
          <groupId>commons-logging</groupId>
          <artifactId>commons-logging</artifactId>
        </exclusion>

        <exclusion>
          <groupId>commons-io</groupId>
          <artifactId>commons-io</artifactId>
        </exclusion>

        <exclusion>
          <groupId>commons-lang</groupId>
          <artifactId>commons-lang</artifactId>
        </exclusion>

        <exclusion>
          <groupId>com.thoughtworks.xstream</groupId>
          <artifactId>xstream</artifactId>
        </exclusion>

        <exclusion>
          <groupId>org.freemarker</groupId>
          <artifactId>freemarker</artifactId>
        </exclusion>

        <exclusion>
          <groupId>org.dbunit</groupId>
          <artifactId>dbunit</artifactId>
        </exclusion>

        <exclusion>
          <groupId>log4j</groupId>
          <artifactId>log4j</artifactId>
        </exclusion>

        <exclusion>
          <groupId>org.codehaus.groovy</groupId>
          <artifactId>groovy-all</artifactId>
        </exclusion>
      </exclusions>
    </dependency>

}}}

=examples=

==DbMigrate.groovy==
In your grails project, you can configure the dbmigrate tool with under grails-app/conf/DbMigrate.groovy

{{{
dbmigrate {
  // when true, use DataSource.groovy to configure connection to database
  dataSource = true
  // when true, compare DbVersion with application.properties#db.version before starting migration
  checkMigrationRequired = true
}

// environment specific settings
environments {
  development {
    dbmigrate {
      mainConfig = "database/setup.xml"
    }
  }
  test {
    dbmigrate {
      mainConfig = "database/setup.xml"
    }
  }
  production {
    dbmigrate {
      mainConfig = "database/upgrade.xml"
    }
  }
}
}}}

==setup.xml==

The rest of the configuration depends on the use of agimatec-tools/dbmigrate. Detailed information about the configuration and features can be found here:
  * http://code.google.com/p/agimatec-tools/wiki/dbmigrate

{{{
<?xml version="1.0" encoding="UTF-8"?>

<config name="migration">

  <map name="env">
  </map>

  <!-- Scripts = the source path for scripts to scan for -->
  <file name="Scripts-Before-All" dir="database/setup/before" file=""/>
  <!--<file name="Scripts" dir="setup" file=""/>-->
  <!--<file name="JdbcConfig" file="database/conf/connect.properties"/>-->

</config>
}}}

==application.properties==
{{{
db.version=1.0.0
}}}

for more information, contact Roman.Stumm@viaboxx.de